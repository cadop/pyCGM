import unittest
import pyCGM_Single.pyCGM as pyCGM
import numpy as np
from parameterized import parameterized

rounding_precision = 8

class TestPycgmAngle(unittest.TestCase):

    @parameterized.expand([
        [[[0.09010104879445179904, 0.99590937599884910014, 0.00680557152145411237],
          [0.99377608791559168822, -0.08945440277921079542, -0.06638521605464120512],
          [-0.06550487076049194002, 0.01274459183355247660, -0.99777085910818641423]],
         [[0.14362551354236074985, -0.98963110439615320502, -0.00141034441480769601],
          [0.68540404438920177199, 0.09844473917718232769, 0.72147760135931093828],
          [-0.71385783444225126004, -0.10458924677044478813, 0.69243633762630452111]],
         [-9.42569150165887, 130.86647058885387, -170.3887751198432]],
        [[[-1, 0, 0], [0, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [1, 0, 0]],
         [-90.0, 0.0, 0.0]],
        [[[0, 1, 0], [0, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [0, 0.70710678118, 0]],
         [45.0, 0.0, 0]],
        [[[0, 0, 0], [-1, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [1, 0, 0]],
         [0.0, 90.0, 0.0]],
        [[[0, 0, 0], [1, 0, 0], [1, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [0.70710678118, 0, 0]],
         [0.0, -45.0, 0]],
        [[[1, 0, 0], [0, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [1, 0, 0], [0, 0, 0]],
         [0.0, 0.0, -90.0]],
        [[[0.70710678118, 0, 0], [0, 0, 0], [0, 0, 0]],
         [[1, 0, 0], [1, 0, 0], [0, 0, 0]],
         [0.0, 0.0, -45.0]]])
    def test_getangle_sho(self, axisP, axisD, expected):
        result = pyCGM.getangle_sho(axisP, axisD)
        np.testing.assert_almost_equal(result, expected, rounding_precision)

    @parameterized.expand([
        [[[0.13232935635315357104, 0.98562945782504129966, -0.10499292030749529658],
          [-0.99119134439010281312, 0.13101087562301927392, -0.01938734831355759525],
          [-0.00535352718324588750, 0.10663358915485332545, 0.99428397221845443710]],
         [[0.09010104879445179904, 0.99590937599884910014, 0.00680557152145411237],
          [0.99377608791559168822, -0.08945440277921079542, -0.06638521605464120512],
          [-0.06550487076049194002, 0.01274459183355247660, -0.99777085910818641423]],
         [-6.4797057790916615, -2.893068979100172, -4.638276625836626]],
        [[[0, 0, 0], [0, 0, 0], [1, 0, 0]],
         [[-1, 0, 0], [0, 0, 0], [0, 0, 0]],
         [90.0, 0.0, 0.0]],
        [[[0, 0, 0], [0, 0, 0], [0, 1, 0]],
         [[0, 0.70710678118, 0], [0, 0, 0], [0, 0, 0]],
         [-45.0, 0.0, 0.0]],
        [[[1, 0, 0], [0, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [1, 0, 0], [0, 0, 0]],
         [0.0, -90.0, 0.0]],
        [[[0, 0.70710678118, 0], [0, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [0, -1, 0], [0, 0, 0]],
         [0.0, 45.0, 0.0]],
        [[[0, 0, 0], [0, 0, 0], [1, 0, 0]],
         [[0, 0, 0], [1, 0, 0], [0, 0, 0]],
         [0.0, 0.0, 90.0]],
        [[[0, 0, 0], [0, 0, 0], [0, 1, 0]],
         [[0, 0, 0], [0, -0.70710678118, 0], [0, 0, 0]],
         [0.0, 0.0, -45.0]]])
    def test_getangle_spi(self, axisP, axisD, expected):
        result = pyCGM.getangle_spi(axisP, axisD)
        np.testing.assert_almost_equal(result, expected, rounding_precision)

    @parameterized.expand([
        [[[1, 0, 0], [0, 1, 0], [0, 0, 1]],
         [[0.13232935635315357103, 0.98562945782504129965, -0.10499292030749529658],
          [-0.99119134439010281312, 0.13101087562301927391, -0.01938734831355759524],
          [-0.00535352718324588749, 0.10663358915485332545, 0.99428397221845443709]],
         [-0.30849491450945404, -6.121292793370006, 7.5714311021517124]],
        [[[1, 0, 0], [0, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [1, 0, 0]],
         [90.0, 0.0, 0.0]],
        [[[1, 0, 0], [0, 0, 0], [1, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [0.70710678118, 0, 0]],
         [45.0, 0.0, 0.0]],
        [[[0, 0, 0], [1, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [1, 0, 0]],
         [0.0, -90.0, 0.0]],
        [[[0, 0, 0], [0, -1, 0], [0, 0, 0]],
         [[0, 0, 0], [0, 0, 0], [0, 0.70710678118, 0]],
         [0.0, 45.0, 0.0]],
        [[[0, 0, 0], [1, 0, 0], [0, 0, 0]],
         [[0, 0, 0], [1, 0, 0], [0, 0, 0]],
         [0.0, 0.0, 90.0]],
        [[[0, 0, 0], [-0.70710678118, 0, 0], [0, 0, 0]],
         [[-1, 0, 0], [-1, 0, 0], [0, 0, 0]],
         [0.0, 0.0, 45.0]]])
    def test_getangle(self, axisP, axisD, expected):
        result = pyCGM.getangle(axisP, axisD)
        np.testing.assert_almost_equal(result, expected, rounding_precision)
